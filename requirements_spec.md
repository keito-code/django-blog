# ブログシステム要件定義書

最終更新日: 2025年7月22日

## プロジェクト概要
大学生のインターンシップ応募向けのシンプルなブログシステム

## 技術スタック
- **バックエンド**: Python 3.10+, Django 5.2.4+
- **データベース**: 
  - 開発環境: SQLite3
  - 本番環境: PostgreSQL（psycopg2-binary 2.9.10+）
- **フロントエンド**: 
  - Bootstrap 5.3.7+（CDN）
  - Bootstrap Icons 1.11.3+（CDN）
- **デプロイ先**: Render.com
- **WSGIサーバー**: Gunicorn 23.0.0+
- **静的ファイル配信**: WhiteNoise 6.9.0+
- **その他ライブラリ**:
  - Markdown 3.8.2+（Markdown記法対応）
  - dj-database-url 3.0.1+（データベースURL解析）
  - python-decouple 3.8+（環境変数管理）

## 機能要件

### 1. ユーザー認証
- **ユーザー登録**: セルフサービス登録機能あり（メールアドレス必須）
- **ログイン機能**: 標準的なユーザー名・パスワード認証
- **ログアウト機能**: あり
- **権限管理**: 
  - 管理者（is_staff=True）: すべての記事の編集・削除が可能
  - 一般ユーザー（登録ユーザー）: 自分の記事のみ投稿・編集・削除可能
  - 未ログインユーザー: 閲覧・コメントのみ

### 2. 記事管理（CRUD機能）
- **記事作成**: すべての登録ユーザーが可能
- **記事編集**: 
  - 一般ユーザー: 自分の記事のみ編集可能
  - 管理者: すべての記事を編集可能
- **記事削除**: 
  - 一般ユーザー: 自分の記事のみ削除可能
  - 管理者: すべての記事を削除可能
- **下書き保存**: あり（draft/publishedステータス）
- **記事一覧表示**: 公開記事のみ表示（投稿者名も表示）
- **下書き一覧**: 各ユーザーは自分の下書きのみ閲覧可能

### 3. 記事の構成要素
- **タイトル**: 最大200文字
- **スラッグ**: URL用（自動生成可能、手動設定も可能）
- **本文**: Markdown対応
- **投稿者**: 自動設定（ログインユーザー）
- **公開日時**: 自動設定（投稿・更新時の現在時刻）
- **ステータス**: 下書き/公開（ユーザーが選択可能）

### 4. Markdown対応
- **見出し**: #, ##, ### に対応
- **太字**: **テキスト** に対応
- **リンク**: [テキスト](URL) に対応
- **リスト**: 箇条書きに対応

### 5. コメント機能
- **投稿者情報**: 名前、メールアドレス（表示はされない）
- **承認機能**: なし（即時公開）
- **削除機能**: 管理画面からのみ可能

### 6. 検索機能
- **検索対象**: 記事のタイトルと本文
- **検索方法**: 部分一致検索
- **検索結果**: ページネーション対応

### 7. 管理機能
- **管理画面**: Django標準の管理画面を使用
- **記事管理**: 一覧表示、フィルタ、検索機能
- **コメント管理**: 一覧表示、有効/無効の切り替え

### 8. UI/UX
- **CSSフレームワーク**: Bootstrap 5.3.7+
- **アイコン**: Bootstrap Icons 1.11.3+（Font Awesomeから移行済み）
- **レスポンシブ対応**: モバイル・タブレット・デスクトップ対応
- **ナビゲーション**: 
  - 記事一覧
  - ログイン/ログアウト/新規登録
  - 新規投稿（登録ユーザーのみ）
  - 管理画面（管理者のみ）
  - マイメニュー（登録ユーザーのみ）: 下書き一覧

### 9. ページネーション
- **表示件数**: 10件/ページ
- **適用箇所**: 
  - 記事一覧
  - 検索結果
  - 下書き一覧

## 非機能要件

### セキュリティ
- **CSRF対策**: Django標準機能を使用
- **認証**: Django標準の認証システム
- **環境変数**: python-decoupleで機密情報を管理

### パフォーマンス
- **静的ファイル配信**: WhiteNoiseを使用
- **データベース接続**: dj-database-urlで管理

### デプロイ
- **Webサーバー**: Gunicorn
- **環境変数管理**: .envファイル（本番環境はRender.comの環境変数）
- **静的ファイル**: collectstaticで収集

## ディレクトリ構成
```
django_blog_env/
├── myblog/              # プロジェクト設定
├── blog/                # ブログアプリ
├── accounts/            # 認証アプリ
├── templates/           # テンプレート
│   ├── base.html
│   ├── blog/
│   └── accounts/
├── static/              # 静的ファイル
├── media/               # アップロードファイル（未使用）
├── venv/                # 仮想環境
├── manage.py
├── requirements.txt     # 依存パッケージ
├── .env                 # 環境変数
└── .gitignore
```

## データモデル

### Postモデル
- title: CharField(200) - 記事タイトル
- slug: SlugField(200, unique=True) - URL用スラッグ（一意制約、自動生成可能）
- author: ForeignKey(User, on_delete=CASCADE) - 投稿者（自動設定）
- content: TextField - 本文（Markdown対応）
- publish: DateTimeField(default=timezone.now) - 公開日時（自動設定）
- created: DateTimeField(auto_now_add=True) - 作成日時（自動設定）
- updated: DateTimeField(auto_now=True) - 更新日時（自動更新）
- status: CharField(max_length=10, choices=['draft', 'published']) - ステータス（ユーザー選択）

### Commentモデル
- post: ForeignKey(Post)
- name: CharField(80)
- email: EmailField
- body: TextField
- created: DateTimeField(auto)
- updated: DateTimeField(auto)
- active: BooleanField(default=True)

## 実装状況

### 実装済み機能一覧

✅ **基本機能**
- ユーザー認証（登録・ログイン・ログアウト）
- 記事のCRUD操作（作成・閲覧・更新・削除）
- 下書き/公開の切り替え
- Markdown記法対応
- コメント機能
- 検索機能
- ページネーション（10件/ページ）
- レスポンシブデザイン

✅ **セキュリティ・権限管理**
- CSRF対策
- 管理者アカウントのブログログイン制限
- 作者のみ編集・削除可能
- ログイン必須機能（新規投稿、下書き一覧）

✅ **UI/UX**
- Bootstrap 5.3.7によるレスポンシブデザイン
- Bootstrap Icons（Font Awesomeから移行済み）
- フラッシュメッセージ
- 日本語UI

### 未実装機能
- .envファイルによる環境変数管理（python-decoupleは導入済み）
- 本番環境設定（DEBUG=False時の設定）
- メディアファイルアップロード
- メール送信機能

## 実装済み機能の詳細

### ユーザー登録機能
- **登録フォーム**: ユーザー名、メールアドレス、パスワード（確認付き）
- **自動ログイン**: 登録完了後、自動的にログインして記事一覧へリダイレクト
- **バリデーション**: 
  - ユーザー名の重複チェック
  - パスワードの強度チェック（8文字以上）
  - メールアドレスの形式チェック
- **メッセージ表示**: 「アカウントが作成されました。ようこそ！」

### ログイン機能
- **管理者制限**: 管理者アカウント（is_staff=True）ではブログシステムにログインできない
- **メッセージ表示**: 「ログインしました。」
- **ログアウト時**: 「ログアウトしました。」

### UI改善履歴
- **2025年7月22日**: Font AwesomeからBootstrap Iconsに移行
- **2025年7月22日**: Bootstrap 5.1.3から5.3.7に更新
- **2025年7月22日**: CDNにintegrity属性とcrossorigin属性を追加

### 権限に基づく表示制御
- **記事一覧**: 編集ボタンは作者本人または管理者のみに表示
- **記事詳細**: 編集・削除リンクは作者本人または管理者のみに表示
- **ナビゲーション**: ログイン状態に応じて表示項目を切り替え

### メッセージ表示システム
- **表示位置**: base.htmlで統一管理（ナビゲーション直下）
- **重複防止**: 個別ページでのメッセージ表示を削除し、1つのメッセージのみ表示

## 今後の拡張案
- タグ・カテゴリ機能
- **記事の予約投稿**（公開日時の手動設定機能）
- RSSフィード
- ソーシャルメディア共有ボタン
- 画像アップロード機能
- より高度なMarkdown対応（コードブロック、テーブルなど）
- メール通知機能（コメント投稿時など）
- ユーザープロフィール機能
- パスワードリセット機能
- 記事の公開日時編集機能